<?xml version="1.0" encoding="utf-8" ?>
<Upgrade OldVersion="1.10" NewVersion="2.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <Preprocessing>
    </Preprocessing>

    <Globals>
        <AddGlobal Description="Adding 'MeasurementCalculationType' global"
                   Name="MeasurementCalculationType"
                   Value="planar"/>

        <AddGlobal Description="Adding 'ProjectOpenOptionsDialogOnLocalSave' global"
                   Name="ProjectOpenOptionsDialogOnLocalSave"
                   Value="true"/>

        <AddGlobal Description="Adding 'InstantSearchMaxHints' global"
                   Name="InstantSearchMaxHints"
                   Value="5"/>

        <AddGlobal Description="Adding 'InstantSearchMaxResults' global"
                   Name="InstantSearchMaxResults"
                   Value="50"/>

        <AddGlobal Description="Adding 'EnableInstantSearchOnSearchHints' global"
                   Name="EnableInstantSearchOnSearchHints"
                   Value="true"/>

        <AddGlobal Description="Adding 'SaveTokenSecuredAttachments' global"
                   Name="SaveTokenSecuredAttachments"
                   Value="true"/>

        <AddGlobal Description="Adding 'ZoomUserAddedLayers' global"
                   Name="ZoomUserAddedLayers"
                   Value="true"/>

        <AddGlobal Description="Adding 'AttributionViewShow' global"
                   Name="AttributionViewShow"
                   Value="true"/>

        <AddGlobal Description="Adding 'ChartsPaneDefaultHeight' global"
                   Name="ChartsPaneDefaultHeight"
                   Value="500"/>

        <AddGlobal Description="Adding 'SearchAutocompleteDelay' global"
                   Name="SearchAutocompleteDelay"
                   Value="300"/>

        <AddGlobal Description="Adding 'SearchAutocompleteMinimumPrefixLength' global"
                   Name="SearchAutocompleteMinimumPrefixLength"
                   Value="3"/>

        <AddGlobal Description="Adding 'MapWrapAround' global"
                   Name="MapWrapAround"
                   Value="false"/>

        <ChangeAttributeDefault Description="Changing default value for 'BannerLeftImageUri' global"
                                Path="/Configuration/*[local-name()='Globals']/*[local-name()='BannerLeftImageUri']"
                                Name="Value"
                                OldDefault="/Resources/Images/BackgroundLeft.png"
                                NewDefault="/Resources/Images/Banners/default-banner.png"/>

        <ChangeAttributeDefault Description="Changing default value for' BannerBackgroundImageUri' global"
                                Path="/Configuration/*[local-name()='Globals']/*[local-name()='BannerBackgroundImageUri']"
                                Name="Value"
                                OldDefault="/Resources/Images/BackgroundRepeat.png"
                                NewDefault="/Resources/Images/Banners/default-banner-bg.png"/>

        <ChangeAttributeDefault Description="Changing default value for 'HomePanelIconUri' global"
                                Path="/Configuration/*[local-name()='Globals']/*[local-name()='HomePanelIconUri']"
                                Name="Value"
                                OldDefault="/Resources/Images/house-32.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/home-32.png"/>

        <ChangeAttributeDefault Description="Changing default value for 'UseInstantSearch' global"
                                Path="/Configuration/*[local-name()='Globals']/*[local-name()='UseInstantSearch']"
                                Name="Value"
                                OldDefault="false"
                                NewDefault="true"/>

    </Globals>

    <UpdateModules>

        <!-- InstantSearch -->

        <ChangeAttributeDefault Description="Changing 'MaxResults' in module InstantSearch"
                                Path="/Configuration/Modules/InstantSearch/Configuration"
                                Name="MaxResults"
                                OldDefault="50"
                                NewDefault="{InstantSearchMaxResults}"/>

        <AddAttribute Description="Adding 'EnableSearchOnSearchHints' in module InstantSearch"
                      Path="/Configuration/Modules/InstantSearch/Configuration"
                      Name="EnableSearchOnSearchHints"
                      Value="{EnableInstantSearchOnSearchHints}" />

        <AddAttribute Description="Adding 'MaxHints' in module InstantSearch"
                      Path="/Configuration/Modules/InstantSearch/Configuration"
                      Name="MaxHints"
                      Value="{InstantSearchMaxHints}" />

        <!-- IWantToMenu -->

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'Create a printable map' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[@Command='PrintMap']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Print.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/print-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'Create a report' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[@Command='RunReport']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Reports.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/reports-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'Draw on the map' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[descendant::*[@Command='ActivateTool' and @CommandParameter='MarkupFreehand']]"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/MarkupFreehand.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/draw-freehand-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'Measure distance' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[descendant::*[@Command='ActivateTool' and @CommandParameter='MeasureDistance']]"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/MeasureDistance.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/measure-distance-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'Share current map' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[@Command='CaptureViewerState']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Share-Map.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/share-map-24.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'Return to initial map extent' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[@Command='ZoomToInitialExtent']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/ZoomInitial.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/zoom-initial-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'Turn map data on/off' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[@ImageUri='/Resources/Images/Layers.png']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Layers.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/layers-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'Add map layer' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[@Command='AddMapLayerInteractive']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/LayersAdd.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/layers-add-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'Show/hide advanced toolbar' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[@Command='ToggleAdvancedTools']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Tools.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/tools-24.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'View results' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[@Command='SwitchToResultsView']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Search.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/search-results-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for 'View selected' item in I Want To menu"
                                Path="/Configuration/Modules/IWantToMenu/Configuration/Menus/Menu[1]/Items/Item[@Command='SwitchToSelectionView']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Star32x32.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/star-32.png"/>

        <!-- LayerCatalog -->

        <AddAttribute Description="Adding 'HideClearButton' in module LayerCatalog"
                      Path="/Configuration/Modules/LayerCatalog/Views/View[@Id='LayerCatalogView']/Configuration"
                      Name="HideClearButton"
                      Value="true" />

        <AddAttribute Description="Adding 'UserLayerWarnLimit' in module LayerCatalog"
                      Path="/Configuration/Modules/LayerCatalog/Views/View[@Id='LayerCatalogView']/Configuration"
                      Name="UserLayerWarnLimit"
                      Value="0" />

        <AddAttribute Description="Adding 'UserLayerMaxLimit' in module LayerCatalog"
                      Path="/Configuration/Modules/LayerCatalog/Views/View[@Id='LayerCatalogView']/Configuration"
                      Name="UserLayerMaxLimit"
                      Value="0" />la

        <AddAttribute Description="Adding 'ZoomUserAddedLayers' in module LayerCatalog"
                      Path="/Configuration/Modules/LayerCatalog/Views/View[@Id='LayerCatalogView']/Configuration"
                      Name="ZoomUserAddedLayers"
                      Value="{ZoomUserAddedLayers}" />

        <AddAttribute Description="Adding 'HideDetailMenu' in module LayerCatalog"
                      Path="/Configuration/Modules/LayerCatalog/Views/View[@Id='LayerCatalogView']/Configuration"
                      Name="HideDetailMenu"
                      Value="true" />

        <!-- LayerList -->

        <ChangeAttributeDefault Description="Changing 'ImageUri' for group layer type icon in module LayerList"
                                Path="/Configuration/Modules/LayerList/Views/View[@Id='LayerListView']/Configuration/LayerTypeIcons/LayerTypeIcon[@LayerType='Group']"
                                Name="ImageUri"
                                OldDefault="/Geocortex.EssentialsSilverlightViewer.Infrastructure;component/Resources/Images/GroupLayer.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/layers-16.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for line layer type icon in module LayerList"
                                Path="/Configuration/Modules/LayerList/Views/View[@Id='LayerListView']/Configuration/LayerTypeIcons/LayerTypeIcon[@LayerType='Line']"
                                Name="ImageUri"
                                OldDefault="/Geocortex.EssentialsSilverlightViewer.Infrastructure;component/Resources/Images/Line.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/line-16.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for polygon layer type icon in module LayerList"
                                Path="/Configuration/Modules/LayerList/Views/View[@Id='LayerListView']/Configuration/LayerTypeIcons/LayerTypeIcon[@LayerType='Polygon']"
                                Name="ImageUri"
                                OldDefault="/Geocortex.EssentialsSilverlightViewer.Infrastructure;component/Resources/Images/Polygon.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/draw-polygon-16.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for point layer type icon in module LayerList"
                                Path="/Configuration/Modules/LayerList/Views/View[@Id='LayerListView']/Configuration/LayerTypeIcons/LayerTypeIcon[@LayerType='Point']"
                                Name="ImageUri"
                                OldDefault="/Geocortex.EssentialsSilverlightViewer.Infrastructure;component/Resources/Images/Point.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/draw-point-16.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for graphics layer type icon in module LayerList"
                                Path="/Configuration/Modules/LayerList/Views/View[@Id='LayerListView']/Configuration/LayerTypeIcons/LayerTypeIcon[@LayerType='Graphics']"
                                Name="ImageUri"
                                OldDefault="/Geocortex.EssentialsSilverlightViewer.Infrastructure;component/Resources/Images/GraphicsLayer.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/layer-graphic-16.png"/>

        <!-- Map -->

        <AddElement Description="Adding 'AttributionView' to Map module"
                    ReplaceExisting="False"
                    Path="/Configuration/Modules/Map/Views"
                    Name="View">
            <View Id="AttributionView" Type="Geocortex.EssentialsSilverlightViewer.CoreModules.Map.AttributionView" Region="AttributionRegion" Visible="{AttributionViewShow}"/>
        </AddElement>

        <AddAttribute Description="Adding 'WrapAround' in module Map"
                      Path="/Configuration/Modules/Map/Configuration"
                      Name="WrapAround"
                      Value="{MapWrapAround}" />

        <!-- MapTips -->

        <ChangeAttributeDefault Description="Changing 'Source' for default layer icon in module MapTips"
                                Path="/Configuration/Modules/MapTips/Configuration/DefaultLayerIcon"
                                Name="Source"
                                OldDefault="/Resources/Images/DefaultResult.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/result-default-32.png"/>

        <AddElement Description="Adding 'SaveTokenSecuredAttachments' in module MapTips"
                    Path="/Configuration/Modules/MapTips/Configuration"
                    Name="SaveTokenSecuredAttachments">
            <SaveTokenSecuredAttachments Value="{SaveTokenSecuredAttachments}" />
        </AddElement>

        <!-- Measurement -->

        <AddAttribute Description="Adding 'CalculationType' in module Measurement"
                      Path="/Configuration/Modules/Measurement/Configuration/MeasurementOptions"
                      Name="CalculationType"
                      Value="{MeasurementCalculationType}" />

        <!-- OpenCsv -->

        <AddElement Description="Adding 'AddCsvView' in module OpenCsv"
                    Path="/Configuration/Modules/OpenCsv"
                    Name="View">
            <View Id="AddCsvView" Region="ModalWindowRegion" Type="Geocortex.EssentialsSilverlightViewer.CoreModules.OpenCsv.SelectLocationFieldsView" Visible="false" />
        </AddElement>

        <AddElement Description="Adding 'AddCsvConfirmationView' in module OpenCsv"
                    Path="/Configuration/Modules/OpenCsv"
                    Name="View">
            <View Id="AddCsvConfirmationView" Region="ModalWindowRegion" Type="Geocortex.EssentialsSilverlightViewer.CoreModules.OpenCsv.ConfirmationView" Visible="false" />
        </AddElement>

        <AddAttribute Description="Adding 'ZoomUserAddedLayers' in module OpenCsv"
                      Path="/Configuration/Modules/OpenCsv/Configuration"
                      Name="ZoomUserAddedLayers"
                      Value="{ZoomUserAddedLayers}" />

        <AddElement Description="Adding 'CreateResultList' in module OpenCsv"
                    Path="/Configuration/Modules/OpenCsv/Configuration"
                    Name="CreateResultList">
            <CreateResultList>true</CreateResultList>
        </AddElement>

        <!-- OpenShapefile -->

        <AddAttribute Description="Adding 'ZoomUserAddedLayers' in module OpenShapefile"
                      Path="/Configuration/Modules/OpenShapefile/Configuration"
                      Name="ZoomUserAddedLayers"
                      Value="{ZoomUserAddedLayers}" />

        <!-- PrintTemplates -->

        <AddElement Description="Adding 'Configuration' in module PrintTemplates"
                    Path="/Configuration/Modules/PrintTemplates"
                    Name="Configuration">
            <Configuration CloseAfterPrint="true" />
        </AddElement>

        <!-- Results -->

        <ChangeAttributeDefault Description="Changing 'Source' for default icon in module Results"
                                Path="/Configuration/Modules/Results/Configuration/DefaultIcon"
                                Name="Source"
                                OldDefault="/Resources/Images/DefaultResult.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/result-default-32.png"/>

        <!-- 
            Note use of "AddAfter" to insert the items in a specific spot within the menu.
        -->
        <AddElement Description="Adding 'Charting View' menu item in module Results"
                    Path="/Configuration/Modules/Results/Configuration/Menus/Menu[@Id='ResultsListActions']/Items/Item[@Command='SwitchToTabularResultsView']"
                    Name="Item"
                    AddAfter="true">
            <Item Text="Charting View" ToolTip="Launch charting view" Command="ShowChartingView" Module="Charting"/>
        </AddElement>

        <AddElement Description="Adding 'Charting View' menu item in module Results"
                    Path="/Configuration/Modules/Results/Configuration/Menus/Menu[@Id='ResultsTableActions']/Items/Item[@Command='SwitchToListResultsView']"
                    Name="Item"
                    AddAfter="true">
            <Item Text="Charting View" ToolTip="Launch charting view" Command="ShowChartingView" Module="Charting"/>
        </AddElement>

        <!-- SaveOpenProject -->

        <AddAttribute Description="Adding 'OpenOptionsDialogOnLocalSave' in module SaveOpenProject"
                      Path="/Configuration/Modules/SaveOpenProject/Configuration"
                      Name="OpenOptionsDialogOnLocalSave"
                      Value="{ProjectOpenOptionsDialogOnLocalSave}" />

        <!-- Selection -->

        <ChangeAttributeDefault Description="Changing 'Source' for default icon in module Selection"
                                Path="/Configuration/Modules/Selection/Configuration/DefaultIcon"
                                Name="Source"
                                OldDefault="/Resources/Images/DefaultResult.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/result-default-32.png"/>

        <!-- Toolbar -->

        <ChangeAttributeDefault Description="Changing 'ImageUri' for pan tool in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Tool[@Name='Pan']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Pan.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/pan-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for zoom-in tool in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Tool[@Name='ZoomIn']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/ZoomIn.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/zoom-in-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for zoom-out tool in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Tool[@Name='ZoomOut']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/ZoomOut.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/zoom-out-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for initial extent button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Initial Extent']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/ZoomInitial.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/zoom-initial-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for full extent button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Full Extent']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/ZoomFullExtent.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/zoom-full-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for previous extent button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Previous Extent']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/ExtentPrevious.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/zoom-previous-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for next extent button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Next Extent']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/ExtentNext.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/zoom-next-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for point identify tool in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Tool[@Name='PointIdentify']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Identify.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/identify-point-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for help button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='LaunchDefaultHelp']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Help.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/help-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for what's this button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='ClickForHelp']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/HelpClickCursor.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/help-cursor-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for show layers button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Show Layers']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Layers.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/layers-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for layer drawing order button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Layer Drawing Order']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/LayersReorder32.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/layers-reorder-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for simple query button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Simple Query']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/QueryBuilderSimple.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/query-builder-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for advanced query button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Advanced Query']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/QueryBuilderAdvanced.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/query-builder-advanced-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for advanced filter button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Advanced Filter']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/FilterBuilderAdvanced.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/filter-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for add map layer button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Add Map Layer']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/LayersAdd.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/layers-add-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for add shapefile button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@DisplayName='Add Shapefile']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/FileSHP.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/shapefile-add-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for add CSV file button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@DisplayName='Add CSV File']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/FileCSV.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/csv-add-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for batch geocode button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@DisplayName='Batch Geocode']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/geocode-batch-32.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/geocode-batch-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for Bing maps button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Command='OpenWebPage' and @CommandParameter='../WMI/BingMaps.html']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/MapBlue.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/map-bing-32.png"/>

        <ChangeAttributeDefault Description="Changing 'DisplayName' for Bing maps button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Command='OpenWebPage' and @CommandParameter='../WMI/BingMaps.html']"
                                Name="DisplayName"
                                OldDefault="Bing? Maps"
                                NewDefault="Bing™ Maps"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for Google maps button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Command='OpenWebPage' and @CommandParameter='../WMI/GoogleMaps.html']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/MapGreen.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/map-google-32.png"/>

        <ChangeAttributeDefault Description="Changing 'DisplayName' for Google maps button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Command='OpenWebPage' and @CommandParameter='../WMI/GoogleMaps.html']"
                                Name="DisplayName"
                                OldDefault="Google Maps?"
                                NewDefault="Google Maps™"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for print map button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Print Map']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Print.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/print-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for reports button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Reports']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Reports.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/reports-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for export map button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Export Map']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/ExportMapImage.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/share-map-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for view results button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='View Results']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Search.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/search-results-32.png"/>

        <ChangeAttributeDefault Description="Changing 'ImageUri' for view selected button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='View Selected']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/Star32x32.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/star-32.png"/>

        <MoveElement Description="Moving drawing tools region out of group in module Toolbar"
                     From="/Configuration/Modules/Toolbar/Configuration/Toolbar/Tab[@DisplayName='Tasks']/Group[@DisplayName='Drawing Tools']/Region[@RegionName='DrawingToolsRegion']"
                     To="/Configuration/Modules/Toolbar/Configuration/Toolbar/Tab[@DisplayName='Tasks']/Group[@DisplayName='Results']"
                     MoveAfter="true"/>

        <RemoveElement Description="Removing group 'Drawing Tools' in module Toolbar"
                       Path="/Configuration/Modules/Toolbar/Configuration/Toolbar/Tab[@DisplayName='Tasks']/Group[@DisplayName='Drawing Tools']" />

        <ChangeAttributeDefault Description="Changing 'ImageUri' for extract button in module Toolbar"
                                Path="/Configuration/Modules/Toolbar/Configuration/Toolbar//Button[@Name='Extract']"
                                Name="ImageUri"
                                OldDefault="/Resources/Images/markup-extract-32.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/draw-extract-32.png"/>

        <RegexTextReplace Description="Upgrading toolbar getting around help items."
                          Match="Insert__Toolbar-GettingAround-Help-Items"
                          ReplaceWith="Insert__Toolbar-GettingAround" />
      
        <!-- UrlIntegration -->

        <AddElement Description="Adding 'addLayer' macro in module UrlIntegration"
                    Path="/Configuration/Modules/UrlIntegration/Configuration/Macros"
                    Name="Macro"
                    Prepend="false">
            <Macro Name="addLayer" WaitsFor="UserLayerAddition" Module="UserLayerAddition" AssemblyHint="CoreModules" />
        </AddElement>

        <!-- UserLayerAddition -->

        <AddAttribute Description="Adding 'ZoomUserAddedLayers' in module UserLayerAddition"
                      Path="/Configuration/Modules/UserLayerAddition/Configuration"
                      Name="ZoomUserAddedLayers"
                      Value="{ZoomUserAddedLayers}" />

        <AddAttribute Description="Adding 'PopulateSearchResultsOnInitialization' in module UserLayerAddition"
                      Path="/Configuration/Modules/UserLayerAddition/Configuration"
                      Name="PopulateSearchResultsOnInitialization"
                      Value="false" />

        <RemoveElement Description="Removing 'ArcGIS' from module UserLayerAddition"
                       Path="/Configuration/Modules/UserLayerAddition/Configuration/ArcGIS" />

        <RemoveElement Description="Removing 'Bing' from module UserLayerAddition"
                       Path="/Configuration/Modules/UserLayerAddition/Configuration/Bing" />

        <ReplaceComment Description="Removing Bing comment from UserLayerAddition module"
                        Path="/Configuration/Modules/UserLayerAddition/Configuration/comment()"
                        Hint="&lt;Bing"
                        Name="(Comment)"/>

        <ReplaceComment Description="Removing WMS comment from UserLayerAddition module"
                        Path="/Configuration/Modules/UserLayerAddition/Configuration/comment()"
                        Hint="&lt;WMS"
                        Name="(Comment)"/>

        <!-- Workflow -->

        <ChangeAttributeDefault Description="Changing 'DefaultIconUri' in module Workflow"
                                Path="/Configuration/Modules/Workflow/Configuration/WorkflowContainers"
                                Name="DefaultIconUri"
                                OldDefault="/Resources/Images/Form.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/form-32.png"/>

        <ChangeAttributeDefault Description="Changing 'IconUri' for 'Default' container in module Workflow"
                                Path="/Configuration/Modules/Workflow/Configuration/WorkflowContainers/WorkflowContainer[@Name='Default']"
                                Name="IconUri"
                                OldDefault="/Resources/Images/Form.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/form-32.png"/>

        <ChangeAttributeDefault Description="Changing 'IconUri' for 'Extract' container in module Workflow"
                                Path="/Configuration/Modules/Workflow/Configuration/WorkflowContainers/WorkflowContainer[@Name='Extract']"
                                Name="IconUri"
                                OldDefault="/Resources/Images/LayersExtract.png"
                                NewDefault="/Resources/Images/Icons/Toolbar/layers-extract-32.png"/>

        <AddElement Description="Adding 'DefaultNoCloseButton' container in module Workflow"
                    Path="/Configuration/Modules/Workflow/Configuration/WorkflowContainers/WorkflowContainer[@Name='Default']"
                    Name="WorkflowContainer"
                    AddAfter="true">
            <WorkflowContainer Name="DefaultNoCloseButton" Title="Workflow" RegionName="DataRegion" IconUri="/Resources/Images/Icons/Toolbar/form-32.png" AllowClose="false" />
        </AddElement>

        <!-- Editing -->
        
        <!-- Merge settings from the former Advanced Editing module into the Editing module. -->
        
        <AddElement Description="Adding 'Copy' tool to Editing module"
                    Path="/Configuration/Modules/Editing/Views/View[@Region='EditToolsRegion']/Configuration/Add"
                    Name="Copy"
                    AddAfter="true">
            <Copy />
        </AddElement>
        
        <AddElement Description="Adding 'AlignToEdge' tool to Editing module"
                    Path="/Configuration/Modules/Editing/Views/View[@Region='EditToolsRegion']/Configuration/EditAttributes"
                    Name="AlignToEdge"
                    AddAfter="true">
            <AlignToEdge />
        </AddElement>
        
        <AddElement Description="Adding 'CreateIntersectionVertices' tool to Editing module"
                    Path="/Configuration/Modules/Editing/Views/View[@Region='EditToolsRegion']/Configuration/AlignToEdge"
                    Name="CreateIntersectionVertices"
                    AddAfter="true">
            <CreateIntersectionVertices />
        </AddElement>

        <MoveElement Description="Moving 'CopyFeaturesView' from AdvancedEditing module to Editing module"
                     From="/Configuration/Modules/AdvancedEditing/Views/View[@Id='CopyFeaturesView']"
                     To="/Configuration/Modules/Editing/Views" />
        <ChangeAttributeDefault Description="Changing type for 'CopyFeaturesView' in module Editing"
                                Path="/Configuration/Modules/Editing/Views/View[@Id='CopyFeaturesView']"
                                Name="Type"
                                OldDefault="Geocortex.EssentialsSilverlightViewer.AdvancedEditing.FeatureCopying.CopyFeaturesView"
                                NewDefault="Geocortex.EssentialsSilverlightViewer.CoreModules.Editing.FeatureCopying.CopyFeaturesView"/>

        <MoveElement Description="Moving 'EditingSnappingView' from AdvancedEditing module to Editing module"
                     From="/Configuration/Modules/AdvancedEditing/Views/View[@Id='EditingSnappingView']"
                     To="/Configuration/Modules/Editing/Views" />
        <ChangeAttributeDefault Description="Changing type for 'EditingSnappingView' in module Editing"
                                Path="/Configuration/Modules/Editing/Views/View[@Id='EditingSnappingView']"
                                Name="Type"
                                OldDefault="Geocortex.EssentialsSilverlightViewer.AdvancedEditing.Snapping.SnappingView"
                                NewDefault="Geocortex.EssentialsSilverlightViewer.CoreModules.Editing.Snapping.SnappingView"/>

        <MoveElement Description="Moving 'MarkupSnappingView' from AdvancedEditing module to Editing module"
                     From="/Configuration/Modules/AdvancedEditing/Views/View[@Id='MarkupSnappingView']"
                     To="/Configuration/Modules/Editing/Views" />
        <ChangeAttributeDefault Description="Changing type for 'MarkupSnappingView' in module Editing"
                                Path="/Configuration/Modules/Editing/Views/View[@Id='MarkupSnappingView']"
                                Name="Type"
                                OldDefault="Geocortex.EssentialsSilverlightViewer.AdvancedEditing.Snapping.SnappingView"
                                NewDefault="Geocortex.EssentialsSilverlightViewer.CoreModules.Editing.Snapping.SnappingView"/>

        <AddAttribute Description="Adding 'IncludeDescriptionInFeatureSelector' in module Editing"
                      Path="/Configuration/Modules/Editing/Configuration"
                      Name="IncludeDescriptionInFeatureSelector"
                      Value="true" />

        <!-- These next two settings should only be carried forward if they were explicitly set. -->
        <MoveAttribute Description="Moving 'CollinearityAngleTolerance' from AdvancedEditing Module to Editing module"
                       Name="CollinearityAngleTolerance"
                       From="/Configuration/Modules/AdvancedEditing/Configuration"
                       To="/Configuration/Modules/Editing/Configuration" />

        <MoveAttribute Description="Moving 'VertexIntersectionTolerance' from AdvancedEditing Module to Editing module"
                       Name="VertexIntersectionTolerance"
                       From="/Configuration/Modules/AdvancedEditing/Configuration"
                       To="/Configuration/Modules/Editing/Configuration" />

        <RemoveElement Description="Removing AdvancedEditing module"
                       Path="/Configuration/Modules/AdvancedEditing" />

        <RemoveElement Description="Removing AdvancedEditing library"
                       Path="/Configuration/Libraries/Library[@Id='AdvancedEditing']" />
      
        <!-- GlobalSearch -->

        <AddAttribute Description="Adding 'MinimumPopulateDelay' in module GlobalSearch"
                      Path="/Configuration/Modules/GlobalSearch/Configuration"
                      Name="MinimumPopulateDelay"
                      Value="{SearchAutocompleteDelay}" />

        <AddAttribute Description="Adding 'MinimumPrefixLength' in module GlobalSearch"
                      Path="/Configuration/Modules/GlobalSearch/Configuration"
                      Name="MinimumPrefixLength"
                      Value="{SearchAutocompleteMinimumPrefixLength}" />
      
    </UpdateModules>

    <DeprecateModules>
    </DeprecateModules>

    <AddModules>
        <AddModule DefaultsOnly="true"
                   Description="Adding Charting module"
                   Name="Charting"
                   ModuleDescription="Charting module"
                   ReplaceExisting="true">

            <Charting>
                <Configuration DefaultHeight="{ChartsPaneDefaultHeight}" />
                <Views>
                    <View Id="ChartingView"
                          Region="ResultsRegion"
                          Type="Geocortex.EssentialsSilverlightViewer.CoreModules.Charting.ChartingView"
                          Visible="false"/>
                </Views>
            </Charting>
        </AddModule>

        <AddModule DefaultsOnly="true"
                   Description="Adding PrintPreview module"
                   Name="PrintPreview"
                   ModuleDescription="Print preview module"
                   ReplaceExisting="true">

            <PrintPreview>
                <Views>
                    <View Id="PrintPreviewView" Visible="false" Region="MapOverlayRegion" />
                </Views>
            </PrintPreview>
        </AddModule>

        <AddModule DefaultsOnly="true"
                   Description="Adding Editing module"
                   Name="Editing"
                   ModuleDescription="Editing module"
                   ReplaceExisting="true">

            <Editing>
                <Views>
                    <View Region="EditToolsRegion">
                        <Configuration>
                            <Add />
                            <Copy />
                            <EditGeometry />
                            <EditAttributes />
                            <AlignToEdge />
                            <CreateIntersectionVertices />
                            <Delete />
                            <Cut />
                            <Reshape />
                            <Union />
                        </Configuration>
                    </View>
                    <View Region="DataRegion" Type="Geocortex.EssentialsSilverlightViewer.CoreModules.Editing.AttributeEditView" Id="AttributeEditView" Visible="false"/>
                    <View Region="DataRegion" Type="Geocortex.EssentialsSilverlightViewer.CoreModules.Editing.FeatureCopying.CopyFeaturesView" Id="CopyFeaturesView"  Visible="false"/>
                    <View Region="EditingSnappingRegion" Type="Geocortex.EssentialsSilverlightViewer.CoreModules.Editing.Snapping.SnappingView" Id="EditingSnappingView">
                        <Configuration HighlightDynamicSnappingLayers="{HighlightDynamicSnappingLayers}" ShowEdgeSnappingOption="true"/>
                    </View>
                    <View Region="MarkupSnappingRegion" Type="Geocortex.EssentialsSilverlightViewer.CoreModules.Editing.Snapping.SnappingView" Id="MarkupSnappingView">
                        <Configuration HighlightDynamicSnappingLayers="{HighlightDynamicSnappingLayers}" ShowEdgeSnappingOption="false"/>
                    </View>
                </Views>
                <Configuration SuppressErrorDialog="false" StickyTools="{StickyTools}" IncludeDescriptionInFeatureSelector="false" />
            </Editing>
        </AddModule>
    </AddModules>

    <DocumentTransformations>

        <AddAttribute Description="Updating version attribute" ReplaceExisting="true" Path="/Configuration" Name="Version" Value="2.0" />

        <RegexTextReplace Description="Updating Uris to virtual directory content" Match="/Templates/SilverlightViewer_1_\d+/VirtualDirectory/" ReplaceWith="/Templates/SilverlightViewer_2_0/VirtualDirectory/" />

        <!-- 
            New users of GVS 2.0 will get a streamlined menu and toolbar in the new Viewer.Defaults.xml.
            Existing users however should not see any changes to their menu or toolbars. Those that didn't
            customize these should get the 'classic' (pre-2.0) settings rather than what's in the new
            Viewer.Defaults.xml.
        -->
        <RegexTextReplace Description="Switching to classic menu and toolbar" 
                          Match="/Templates/SilverlightViewer_2_0/VirtualDirectory/Viewer.Defaults.xml" 
                          ReplaceWith="/Templates/SilverlightViewer_2_0/VirtualDirectory/Viewer.Classic.xml" />
        
    </DocumentTransformations>

</Upgrade>
